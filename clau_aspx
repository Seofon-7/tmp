<dx:ASPxGridView ID="gridFrequency" runat="server" AutoGenerateColumns="False" KeyFieldName="ID"
    OnRowInserting="gridFrequency_RowInserting" OnRowUpdating="gridFrequency_RowUpdating"
    OnInit="gridFrequency_Init" OnCustomCallback="gridFrequency_CustomCallback"
    ClientInstanceName="gridFrequency" Width="100%">
    <SettingsEditing Mode="Inline" />
    <SettingsBehavior ConfirmDelete="true" />
    <Columns>
        <dx:GridViewCommandColumn ShowEditButton="true" ShowDeleteButton="true" ShowNewButtonInHeader="true" />
        <dx:GridViewDataTextColumn FieldName="ID" ReadOnly="true" Visible="false" />
        
        <!-- 頻率欄位 -->
        <dx:GridViewDataColumn FieldName="FREQUENCY" Caption="頻率設定">
            <DataItemTemplate>
                <%# FormatFrequencyDisplay(Eval("FREQUENCY")) %>
            </DataItemTemplate>
            <EditItemTemplate>
                <table>
                    <tr>
                        <td>
                            每
                            <dx:ASPxSpinEdit ID="txtFreqCount" runat="server" 
                                Value='<%# GetFreqValue(Eval("FREQUENCY")) %>' 
                                MinValue="1" Width="60px" ClientInstanceName="txtFreqCount">
                                <ClientSideEvents Init="function(s, e) { txtFreqCountInstance = s; }" />
                            </dx:ASPxSpinEdit>
                            次：
                        </td>
                        <td>
                            <dx:ASPxSpinEdit ID="txtFreqUnitCount" runat="server" 
                                Value='<%# GetFreqUnitCountValue(Eval("FREQUENCY")) %>' 
                                MinValue="1" Width="60px" ClientInstanceName="txtFreqUnitCount">
                                <ClientSideEvents Init="function(s, e) { txtFreqUnitCountInstance = s; }" />
                            </dx:ASPxSpinEdit>
                        </td>
                        <td>
                            <dx:ASPxComboBox ID="cmbFreqUnit" runat="server" 
                                Value='<%# GetFreqUnitValue(Eval("FREQUENCY")) %>' 
                                Width="60px" ClientInstanceName="cmbFreqUnit">
                                <ClientSideEvents Init="function(s, e) { cmbFreqUnitInstance = s; }" />
                                <Items>
                                    <dx:ListEditItem Text="天" Value="D" />
                                    <dx:ListEditItem Text="週" Value="W" />
                                </Items>
                            </dx:ASPxComboBox>
                        </td>
                    </tr>
                </table>
                <!-- 隱藏欄位存儲組合後的值 -->
                <dx:ASPxHiddenField ID="hfCombinedFrequency" runat="server" ClientInstanceName="hfCombinedFrequency">
                </dx:ASPxHiddenField>
            </EditItemTemplate>
        </dx:GridViewDataColumn>
        
        <!-- 其他欄位... -->
    </Columns>
    <Toolbars>
        <dx:GridViewToolbar>
            <Items>
                <dx:GridViewToolbarItem Command="New" Text="新增" />
            </Items>
        </dx:GridViewToolbar>
    </Toolbars>
    <ClientSideEvents BeforePerformDataInsert="function(s, e) { return CombineFrequencyValues(); }"
                       BeforePerformDataUpdate="function(s, e) { return CombineFrequencyValues(); }" />
</dx:ASPxGridView>

<!-- JavaScript 函數 -->
<script type="text/javascript">
    var txtFreqCountInstance, txtFreqUnitCountInstance, cmbFreqUnitInstance;
    
    function CombineFrequencyValues() {
        if (!txtFreqCountInstance || !txtFreqUnitCountInstance || !cmbFreqUnitInstance) 
            return true;
            
        var freqCount = txtFreqCountInstance.GetValue() || 1;
        var unitCount = txtFreqUnitCountInstance.GetValue() || 1;
        var unit = cmbFreqUnitInstance.GetValue() || 'D';
        
        var combinedValue = freqCount + '/' + unitCount + unit;
        
        // Store the value in a hidden field or callback
        ASPxClientGridView.Cast(gridFrequency).GetEditingRowValues('FREQUENCY', function(values) {
            // Using a custom callback to send this value to server
            gridFrequency.PerformCallback('SETFREQUENCY|' + combinedValue);
        });
        
        return true;
    }
</script>
